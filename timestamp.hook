#!/bin/bash

cd `git rev-parse --show-toplevel`

ALLSTAGEDFILES=`git diff --cached --name-only --diff-filter=ACMR`
TIMESTAMP=$( date +"%Y-%m-%d %H:%M" )

for FILE in $ALLSTAGEDFILES; do
    sed -i "1,20 s/\(.*\(Last\)\?\s*\([Cc]hanged\?\|[Mm]odified\|[Uu]pdated\?\)\s*:\s*\)\([0-9]*-[0-9]*-[0-9]* [0-9]*:[0-9]*\)/\1$TIMESTAMP/g" $FILE
    git add $FILE
done

exit 0
